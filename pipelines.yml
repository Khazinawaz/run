pipelines:
  - name: Run_State_Example_2
    steps:
      - name: start
        type: Bash
        execution:
          onExecute:
            - echo "Start..."

      - name: step_a
        type: Bash
        configuration:
          inputSteps:
            - name: start
        execution:
          onStart:
            - sleep 10
            - mkdir -p files
            - filename="${step_name}_${steplet_number}"
            - echo "I am on step ${step_name} ${steplet_number}" > ./files/$filename
          onExecute:
            - add_run_files ./files state
          onComplete:
            - echo "${step_name} Completed"

      - name: step_b
        type: Bash
        configuration:
          inputSteps:
            - name: start
        execution:
          onStart:
            - sleep 10
            - mkdir -p files
            - filename="${step_name}_${steplet_number}"
            - echo "I am on step ${step_name} ${steplet_number}" > ./files/$filename
          onExecute:
            - add_run_files ./files state
          onComplete:
            - echo "${step_name} Completed"

      - name: step_c
        type: Bash
        configuration:
          inputSteps:
            - name: step_a
            - name: step_b
        execution:
          onStart:
            - restore_run_files state ./files
            - filename="${step_name}_${steplet_number}"
            - echo "I am on step ${step_name} ${steplet_number}" > ./files/$filename
          onExecute:
            - add_run_files ./files state
          onComplete:
            - echo "${step_name} Completed"

      - name: step_d
        type: Bash
        configuration:
          inputSteps:
            - name: step_c
        execution:
          onStart:
            - restore_run_files state ./files
            - filename="${step_name}_${steplet_number}"
            - echo "I am on step ${step_name} ${steplet_number}" > ./files/$filename
          onExecute:
            - add_run_files ./files state
          onComplete:
            - echo "${step_name} Completed"

      - name: step_e
        type: Bash
        configuration:
          inputSteps:
            - name: step_c
        execution:
          onStart:
            - restore_run_files state ./files
            - filename="${step_name}_${steplet_number}"
            - echo "I am on step ${step_name} ${steplet_number}" > ./files/$filename
          onExecute:
            - add_run_files ./files state
          onComplete:
            - echo "${step_name} Completed"


      - name: step_f
        type: Bash
        configuration:
          inputSteps:
            - name: step_d
            - name: step_e
        execution:
          onStart:
            - restore_run_files state ./files
            - filename="${step_name}_${steplet_number}"
            - echo "I am on step ${step_name} ${steplet_number}" > ./files/$filename
          onExecute:
            - add_run_files ./files state
          onComplete:
            - echo "${step_name} Completed"